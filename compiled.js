(function(){var Ra=Math.imul||function(b,a){var c=b>>16&65535,d=a>>16&65535,e=b&65535,g=a&65535;return e*g+(c*g+e*d<<16)|0};function Xa(){var b=0,a=!1,c=null,d={},e=new Sa,g=e.e.domElement,i=null,h=function(){d={},a=!1},j=function(m){d[m.which]=1,m.which===84?Ba(e.g.a):m.which===71?ya(e.i):m.which===70?Ca(e.g.a):m.which===79&&Da(e.g.a)},l=function(o){d[o.which]=0},p=function(f){f.ctrlKey||P(e,f.deltaX*-.007853981633974483,f.deltaY*-.007853981633974483),f.preventDefault()},r=function(k){a=!0,k.preventDefault()},q=function(){a=!1},w=function(s){if(a){var v=c?s.pageX-c.pageX:0,n=c?s.pageY-c.pageY:0;P(e,v*.007853981633974483,n*.007853981633974483)}c=s},t=function(){var u=window.devicePixelRatio;aa(e,Math.round(window.innerWidth*u)|0,Math.round(window.innerHeight*u)|0)},A=0;i=function(){if(++A,!(A%2)){var C=window.performance.now(),M=Math.min(.25,(C-b)/1000);b=C;var O=y(d,68,0)-y(d,65,0)|0,N=y(d,83,0)-y(d,87,0)|0;ba(e,O,N,M,y(d,32,0)!=0,y(d,16,0)!=0),ca(e,M),document.title=da(e)}window.requestAnimationFrame(i)},t(),
i();var K=document.createElement('div'),B=K.style;B.position='absolute',B.left=B.top='20px',B.padding='13px 15px',B.background='rgba(0, 0, 0, 0.5)',B.color='white',B.pointerEvents='none',B.whiteSpace='pre',B.font='14px/20px sans-serif',B.borderRadius='5px',K.textContent='W/A/S/D: Move\nShift: Move fast\nDrag: Rotate\nT: Toggle textures\nG: Toggle godrays\nF: Toggle fog\nO: Toggle occlusion',document.body.appendChild(g),document.body.appendChild(K),document.onkeydown=j,document.onkeyup=l,window.onblur=h,window.onresize=t,window.onmousedown=r,window.onmouseup=q,window.onmousemove=w,window.onwheel=p}function aa(c,b,a){c.d.setViewOffset(b,a,0,0,b,a),c.d.updateProjectionMatrix(),c.e.setSize(b,a,!1),c.i.h.setSize(b,a)}function ba(h,b,a,c,d,e){h.a.set(0,0,0),e?((b!=0||a!=0)&&(h.a.set(b,0,a).normalize().multiplyScalar(c*20),h.a.applyEuler(h.d.rotation)),h.m=0):((b!=0||a!=0)&&(h.a.set(b,0,a).normalize().multiplyScalar(c*4),h.a.applyAxisAngle(h.b,h.d.rotation.y)),h.m-=c*9.8,h.a.y=h.m*c),Ka(h.g.a,h.h,h.a);var g=Ja(h.g.a,
h.h),i=Ia(h.g.a,h.h);d&&i?h.m=6:(g||i)&&(h.m=0)}function P(d,b,a){var c=d.d.rotation;c.x=Math.min(1.5707963267948966,Math.max(-1.5707963267948966,c.x-a)),c.y-=b,c.y-=Math.floor(c.y/6.283185307179586)*6.283185307179586}function ca(c,b){c.j=c.j*.9+.1/b,c.d.position.copy(c.h.b),c.d.position.y+=.4,c.d.updateMatrixWorld(),c.d.matrixWorldInverse.getInverse(c.d.matrixWorld),Ga(c.g.a,b,c.d,c.e);var a=c.i.h;c.e.setViewport(0,0,a.width,a.height),c.e.render(c.c,c.d,a),za(c.i,c.e,c.d)}function da(b){return Math.round(b.j)+' fps/'+Math.round(b.g.a.r)+' units/'+Fa(b.g.a)+' quads'}function ea(b){return b.b.subarray(0,b.a)}function fa(a,b){(a.a+1|0)>a.c&&R(a),a.b[a.a]=b,++a.a}function Q(d,b,a,c){(d.a+3|0)>d.c&&R(d),d.b[d.a]=b,d.b[d.a+1|0]=a,d.b[d.a+2|0]=c,d.a+=3}function R(a){a.c*=2;var b=new Int32Array(a.c);a.b&&b.set(a.b),a.b=b}function E(b){return b.b.subarray(0,b.a)}function ga(c,b,a){(c.a+2|0)>c.c&&L(c),c.b[c.a]=b,c.b[c.a+1|0]=a,c.a+=2}function F(d,b,a,c){(d.a+3|0)>d.c&&L(d),d.b[d.a]=b,d.b[d.a+1|0]=a,d.b[d.a+2|0]=c,d.a+=3}
function ha(e,b,a,c,d){(e.a+4|0)>e.c&&L(e),e.b[e.a]=b,e.b[e.a+1|0]=a,e.b[e.a+2|0]=c,e.b[e.a+3|0]=d,e.a+=4}function L(a){a.c*=2;var b=new Float32Array(a.c);a.b&&b.set(a.b),a.b=b}function la(e){S(e);for(var b=0;b<6;++b){var a=e.m[b];if(a){var c=(b+3|0)%6;a.m[c].C=!0,a.m[c]=null}}if(e.k.a){for(var d=0,g=e.k.a;d<g;++d)V(e.b.f,e.k.b[d]);e.k.a=0}e.s=null,e.v={}}function S(b){b.t&&(b.a.remove(b.t),b.t=null),b.u&&(b.c.remove(b.u),b.u=null),b.A&&(b.d.remove(b.A),b.A=null),b.n&&(b.n.dispose(),b.n=null)}function ma(b){return b.g>>5&1023|b.i<<5&1047552|b.h<<15&1072693248}function na(d,b,a,c){return b-=d.g,a-=d.i,c-=d.h,b>-1&&b<32&&a>-1&&a<32&&c>-1&&c<32}function oa(c,b,a){c.m[a]=b,b.m[(a+3|0)%6]=c,c.C=b.C=!0}function pa(d,b,a,c){return na(d,b,a,c)?d.j[(b-d.g|0)+((a-d.i|0)+(c-d.h<<5)<<5)|0]:0}function qa(a){if(a.C){S(a),a.k.a=0,a.s={},ra(a);for(var c=0,d=_(a.v),e=d.length;c<e;++c){var b=d[c];V(a.b.f,b)}a.v=a.s,a.s=null,a.n=new THREE.BufferGeometry,a.n.setIndex(THREE.Uint16Attribute(ea(a.r),1)),a.n.addAttribute('position',THREE.Float32Attribute(E(a.l),
3)),a.n.addAttribute('uvs',THREE.Float32Attribute(E(a.o),4)),a.n.addAttribute('updateUV',THREE.Float32Attribute(E(a.p),2)),a.n.addAttribute('updatePosition',THREE.Float32Attribute(E(a.f),3)),a.t=new THREE.Mesh(a.n,a.e),a.u=new THREE.Mesh(a.n,a.b.f.g),a.A=new THREE.Mesh(a.n,a.b.f.i),a.a.add(a.t),a.c.add(a.u),a.d.add(a.A),a.A.frustumCulled=!1,a.l.a=a.o.a=0,a.p.a=a.f.a=0,a.r.a=0,a.C=!1}}function ra(n){for(var b=Qa,a=0,c=n.g,d=n.i,e=n.h,g=0,A=33;g<A;++g)for(var i=0,u=33;i<u;++i)for(var h=0,t=33;h<t;++h){if(i<32&&g<32){var j=0,m=0;if(h>0)j=n.j[(h-1|0)+(i+(g<<5)<<5)|0];else{var l=n.m[0];l&&(j=l.j[31+(i+(g<<5)<<5)|0])}if(h<32)m=n.j[h+(i+(g<<5)<<5)|0];else{var o=n.m[3];o&&(m=o.j[i+(g<<5)<<5])}!j&&m?D(n,c+h|0,(d+i|0)+1|0,(e+g|0)+1|0,0,0,-1,0,-1,0,b[Ra(m,3)+2|0],a):j&&!m&&D(n,c+h|0,(d+i|0)+1|0,e+g|0,0,0,1,0,-1,0,b[Ra(j,3)+2|0],a+1|0)}if(h<32&&g<32){var p=0,f=0;if(i>0)p=n.j[h+((i-1|0)+(g<<5)<<5)|0];else{var r=n.m[1];r&&(p=r.j[h+(31+(g<<5)<<5)|0])}if(i<32)f=n.j[h+(i+(g<<5)<<5)|0];else{var k=n.m[4];k&&(f=k.j[h+(g<<10)|0])}
!p&&f?D(n,c+h|0,d+i|0,e+g|0,1,0,0,0,0,1,b[Ra(f,3)+1|0],a+2|0):p&&!f&&D(n,(c+h|0)+1|0,d+i|0,e+g|0,-1,0,0,0,0,1,b[Ra(p,3)],a+3|0)}if(h<32&&i<32){var q=0,w=0;if(g>0)q=n.j[h+(i+(g-1<<5)<<5)|0];else{var s=n.m[2];s&&(q=s.j[h+(i+992<<5)|0])}if(g<32)w=n.j[h+(i+(g<<5)<<5)|0];else{var v=n.m[5];v&&(w=v.j[h+(i<<5)|0])}!q&&w?D(n,c+h|0,(d+i|0)+1|0,e+g|0,1,0,0,0,-1,0,b[Ra(w,3)+2|0],a+4|0):q&&!w&&D(n,(c+h|0)+1|0,(d+i|0)+1|0,e+g|0,-1,0,0,0,-1,0,b[Ra(q,3)+2|0],a+5|0)}a+=6}}function D(u,b,a,c,d,e,g,i,h,j,m,l){var o=b+d*.5+i*.5,p=a+e*.5+h*.5,f=c+g*.5+j*.5,r=(1+m%16|0)/16-.0001,k=1-(m/16|0)/16-.0001,q=r-.0625+.0002,w=k-.0625+.0002,s=u.l.a/3|0;Q(u.r,s,s+1|0,s+2|0),Q(u.r,s,s+2|0,s+3|0);var v=y(u.v,l,-1);~v?delete u.v[l]:v=ua(u.b.f);var n=u.w,t=u.q;va(u.b.f,v,n),W(u.b.f,v,t),fa(u.k,v),u.s[l]=v,G(u,b,a,c,r,k,n.min.x,n.min.y,t.min.x,t.min.y,o,p,f),G(u,b+d|0,a+e|0,c+g|0,q,k,n.max.x,n.min.y,t.max.x,t.min.y,o,p,f),G(u,(b+d|0)+i|0,(a+e|0)+h|0,(c+g|0)+j|0,q,w,n.max.x,n.max.y,t.max.x,t.max.y,o,p,f),G(u,b+i|0,a+h|0,c+j|0,r,w,n.min.x,n.max.y,t.min.x,
t.max.y,o,p,f)}function sa(b){return b.k?b.k.a:0}function G(p,b,a,c,d,e,g,i,h,j,m,l,o){F(p.l,b,a,c),ha(p.o,d,e,g,i),ga(p.p,h,j),F(p.f,m+(b-m)*2,l+(a-l)*2,o+(c-o)*2)}function ta(k){for(var b=k.h,s=k.h+32|0;b<s;++b)for(var a=k.g,w=k.g+32|0;a<w;++a)for(var c=Math.round(35.2+Na(a*.02,b*.02)*16)|0,d=(a-k.g|0)+(b-k.h<<10)|0,e=Math.max(0,k.i),q=Math.min(c,k.i+32|0);e<q;++e){var g=(e+1|0)^c?e<(c-3|0)?3:1:2;k.j[d+(e-k.i<<5)|0]=g}for(var i=0;i<6;++i){var h=63-Ra(i,10)|0;if(h>=k.i&&h<(k.i+32|0))for(var j=k.h,n=k.h+32|0;j<n;++j)for(var m=k.g,v=k.g+32|0;m<v;++m){var l=m*.01,o=j*.01;o/=.866025404,l-=o*.5,i&1&&(l-=1/3),l-=Math.floor(l),o-=Math.floor(o);var p=1-l-o;p<0&&(l=1-l,o=1-o,p=-p);var f=Math.max(Math.max(l,o),p),r=Math.min(Math.min(l,o),p);!(f>.6966666666666667)&&(!(f<.6366666666666666)||!(r>.03))&&(k.j[(m-k.g|0)+((h-k.i|0)+(j-k.h<<5)<<5)|0]=5)}}k.C=!0}function ua(a){if(a.t==-1)return-1;var b=a.t;return a.t=a.m[b],W(a,b,a.l),U(a,a.l.min.x,a.l.min.y,a.l.max.x,a.l.min.y,a.l.max.x,a.l.max.y),U(a,a.l.min.x,a.l.min.y,a.l.max.x,
a.l.max.y,a.l.min.x,a.l.max.y),b}function U(i,b,a,c,d,e,g){F(i.w,b*2-1,a*2-1,0),F(i.w,c*2-1,d*2-1,0),F(i.w,e*2-1,g*2-1,0)}function V(a,b){~b&&(a.m[b]=a.t,a.t=b)}function W(e,b,a){var c=b%e.b|0,d=b/e.b|0;a.min.x=c/e.b,a.min.y=d/e.a,a.max.x=(c+1)/e.b,a.max.y=(d+1)/e.a}function va(e,b,a){var c=b%e.b<<1,d=b/e.b<<1;a.min.x=(c+.5)/(e.b<<1),a.min.y=(d+.5)/(e.a<<1),a.max.x=(c+1.5)/(e.b<<1),a.max.y=(d+1.5)/(e.a<<1)}function wa(f,b,a,c){if(f.n%2){if(b.autoClear=!1,b.setViewport(0,0,f.s.width,f.s.height),f.w.a){var l=new THREE.BufferGeometry;l.addAttribute('position',THREE.Float32Attribute(E(f.w),3));var o=new THREE.Mesh(l,f.h);o.frustumCulled=!1,f.e.add(o),b.render(f.e,f.q,f.s),f.e.remove(o),f.w.a=0}f.i.uniforms.rayLight.value.copy(f.k),f.i.uniforms.previous.value=f.s,b.render(f.d,f.q,f.v),b.autoClear=!0;var p=f.s;f.s=f.v,f.v=p}else{var d=Math.random()*6.283185307179586,e=Math.asin(Math.random()*2-1);f.k.set(Math.cos(d)*Math.cos(e),Math.sin(e),Math.sin(d)*Math.cos(e)),f.k.y=Math.abs(+f.k.y),f.n%6?f.k.multiplyScalar(.1).add(c).normalize():(f.k.y+=1,
f.k.normalize()),f.r.set(f.k.y,f.k.z,f.k.x).cross(f.k).normalize(),f.f.copy(f.r).cross(f.k).normalize(),f.o.min.set(Infinity,Infinity,Infinity),f.o.max.set(-Infinity,-Infinity,-Infinity);for(var r=0,k=a.d,q=k.length;r<q;++r)for(var g=k[r],i=0;i<8;++i){var h=g.g+(i&1?32:0),j=g.i+(i&2?32:0),m=g.h+(i&4?32:0);f.p.set(h,j,m),f.p.set(f.p.dot(f.f),f.p.dot(f.r),f.p.dot(f.k)),f.o.expandByPoint(f.p)}f.o.expandByScalar(1),f.q.left=f.o.min.x,f.q.right=f.o.max.x,f.q.bottom=f.o.min.y,f.q.top=f.o.max.y,f.q.near=-f.o.max.z,f.q.far=-f.o.min.z,f.q.matrix.makeBasis(f.f,f.r,f.k),f.q.matrix.decompose(f.q.position,f.q.quaternion,f.q.scale),f.q.updateProjectionMatrix(),b.setViewport(0,0,f.j.width,f.j.height),b.render(f.c,f.q,f.j)}++f.n}function ya(b){b.j=!b.j}function za(g,b,a){var c=g.a.uniforms,d=g.b.c.position;g.c.set(d.x,d.y,d.z,0),g.c.applyMatrix4(g.e.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse)),c.uvLight.value.set(g.c.x/g.c.w*.5+.5,g.c.y/g.c.w*.5+.5),c.rayLight.value.copy(d),c.cameraToWorldMatrix.value.multiplyMatrices(a.matrixWorld,
g.e.getInverse(a.projectionMatrix)),g.d.set(0,0,1),g.d.applyMatrix4(c.cameraToWorldMatrix.value),g.d.normalize();var e=d.x*g.d.x+d.y*g.d.y+d.z*g.d.z;c.godrayStrength.value=g.j?Math.max(0,Math.pow(Math.max(0,e),4)/2-.1):0,c.randomSeed.value=Math.random(),b.render(g.g,g.i)}function Ba(a){var b=a.c.uniforms.renderTextureMap;b.value=!b.value}function Ca(a){var b=a.c.uniforms.renderFog;b.value=!b.value}function Da(a){var b=a.c.uniforms.renderOcclusion;b.value=!b.value}function Ea(x,b){x.j.setFromMatrix(x.l.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse));for(var a=x.r+Math.sqrt(3072)/2,c=b.position,d=Math.floor((c.x-a)/32)|0,e=Math.ceil((c.x+a)/32)|0,g=Math.max(0,Math.floor((c.y-a)/32)|0),i=Math.min(2,Math.ceil((c.y+a)/32)|0),h=Math.floor((c.z-a)/32)|0,j=Math.ceil((c.z+a)/32)|0,m=0;m<x.d.length;){var l=x.d[m];X(c.x,c.y,c.z,l.g+16,l.i+16,l.h+16)>a?(delete x.e[ma(l)],x.d.splice(m,1),la(l)):++m}for(var o=null,p=-Infinity,f=d;f<e;++f)for(var r=f<<5,k=g;k<i;++k)for(var q=k<<5,w=h;w<j;++w){var s=w<<5,v=X(c.x,c.y,
c.z,r+16,q+16,s+16);if(!(v>a)){var n=r>>5&1023|q<<5&1047552|s<<15&1072693248,t=y(x.e,n,null);if(!t){t=new Va(x,x.g,x.i,x.h,x.c,r,q,s),ta(t),x.e[n]=t,x.d.push(t);for(var u=0;u<6;++u){var A=u,C=r+(ia(A)<<5)|0,M=q+(ja(A)<<5)|0,O=s+(ka(A)<<5)|0,N=y(x.e,C>>5&1023|M<<5&1047552|O<<15&1072693248,null);N&&oa(t,N,A)}x.m.min.set(r,q,s),x.m.max.set(r+32|0,q+32|0,s+32|0)}if(t.C){var K=x.j.intersectsBox(x.m),B=K?x.r-v:-v;B>p&&(o=t,p=B)}}}o&&qa(o)}function Fa(c){for(var b=0,d=0,e=c.d,g=e.length;d<g;++d){var a=e[d];b+=sa(a)}return b}function Ga(e,b,a,c){e.k=e.k*.95+.05/b,e.r=Math.max(64,Math.min(128,e.r+(e.k-25)*b)),Ea(e,a);var d=e.c.uniforms;d.drawDistance.value=e.r,d.randomSeed.value=Math.random(),d.rayLight.value.copy(e.b.c.position),d.renderOcclusion.value&&wa(e.f,c,e,e.b.c.position)}function Ha(g,b,a,c){var d=(b&-32)>>5&1023|(a&-32)<<5&1047552|(c&-32)<<15&1072693248,e=y(g.e,d,null);return e?pa(e,b,a,c):0}function Ia(d,b){var a=d.o.copy(b.b).sub(b.a).floor(),c=d.p.copy(b.b).add(b.a).ceil();return b.b.y-b.a.y-a.y<.01&&!H(d,
a.x,c.x+1,a.y-1,a.y-1,a.z,c.z+1)}function Ja(d,b){var a=d.o.copy(b.b).sub(b.a).floor(),c=d.p.copy(b.b).add(b.a).ceil();return c.y-b.b.y-b.a.y<.01&&!H(d,a.x,c.x+1,c.y,c.y,a.z,c.z+1)}function H(m,b,a,c,d,e,g){for(var i=b,p=a+1|0;i<p;++i)for(var h=c,o=d+1|0;h<o;++h)for(var j=e,l=g+1|0;j<l;++j)if(Ha(m,i,h,j))return!1;return!0}function Ka(c,b,a){a.y>0&&I(c,b,1,a.y),I(c,b,0,a.x),I(c,b,2,a.z),a.y<0&&I(c,b,1,a.y)}function I(o,b,a,c){if(c!=0){var d=o.o.copy(b.b).sub(b.a).floor(),e=o.p.copy(b.b).add(b.a).ceil(),g=b.b.getComponent(a),i=b.a.getComponent(a);if(c<0){for(var h=Math.floor(g-i+c)|0,j=Math.floor(g-i-1)|0;j>=h;--j)if(!H(o,a?d.x:j,a?e.x-1:j,a^1?d.y:j,a^1?e.y-1:j,a^2?d.z:j,a^2?e.z-1:j)){b.b.setComponent(a,(j+1|0)+i+.0001);return}}else if(c>0)for(var m=Math.ceil(g+i+c-1)|0,l=Math.ceil(g+i)|0;l<=m;++l)if(!H(o,a?d.x:l,a?e.x-1:l,a^1?d.y:l,a^1?e.y-1:l,a^2?d.z:l,a^2?e.z-1:l)){b.b.setComponent(a,l-i-.0001);return}b.b.setComponent(a,g+c)}}function X(b,a,c,d,e,g){return b-=d,a-=e,c-=g,Math.sqrt(b*b+a*a+c*c)}function La(b,a){
var c=b+Ra(a,57)|0;return c=c<<13^c,1-(Ra(c,Ra(Ra(c,c),15731)+789221|0)+1376312589&2147483647)*(1/1073741824)}function Y(b){return b*b*(3-b*2)}function Ma(b,a){for(var c=Math.floor(b)|0,d=Math.floor(a)|0,e=Y(b-c),g=Y(a-d),i=0,h=0;h<4;++h){var j=h&1,m=h>>1&1;i+=La(c+j|0,d+m|0)*(j?e:1-e)*(m?g:1-g)}return i}function Na(b,a){for(var c=0,d=1,e=0;e<3;++e)c+=Ma(b,a)*d,d*=.5,b*=2,a*=2;return c}function y(d,b,a){var c=d[b];return c!==void 0?c:a}function _(c){var b=[];for(var a in c)b.push(c[a]);return b}function ia(b){return b?b^3?0:1:-1}function ja(b){return b^1?b^4?0:1:-1}function ka(b){return b^2?b^5?0:1:-1}function Sa(){this.b=new THREE.Vector3(0,1,0),this.a=new THREE.Vector3,this.c=new THREE.Scene,this.d=new THREE.PerspectiveCamera(75,1,.1,1000),this.e=new THREE.WebGLRenderer,this.g=this.i=null,this.h=new _a,this.j=this.m=0,this.g=new $a(this.c),this.i=new Ya(this.g),this.h.b.y=50,this.h.a.set(.4,.8,.4),this.d.rotation.order='YXZ',this.e.setClearColor(0,0),this.e.gammaInput=this.e.gammaOutput=!0}function Ta(){this.b=new Int32Array(256),
this.a=0,this.c=256}function Ua(){this.b=new Float32Array(256),this.a=0,this.c=256}function Va(b,a,c,d,e,g,i,h){this.b=b,this.a=a,this.c=c,this.d=d,this.e=e,this.g=g,this.i=i,this.h=h,this.j=new Uint8Array(32768),this.m=[null,null,null,null,null,null],this.l=new Ua,this.o=new Ua,this.p=new Ua,this.f=new Ua,this.r=new Ta,this.k=new Ta,this.q=new THREE.Box2,this.w=new THREE.Box2,this.s=null,this.v={},this.n=this.t=null,this.u=this.A=null,this.C=!1}function Wa(b,a){this.b=this.a=0,this.c=new THREE.Scene,this.d=new THREE.Scene,this.e=new THREE.Scene,this.g=this.i=null,this.h=this.j=null,this.m=null,this.l=new THREE.Box2,this.o=new THREE.Box3,this.p=new THREE.Vector3,this.f=new THREE.Vector3,this.r=new THREE.Vector3,this.k=new THREE.Vector3,this.q=new THREE.OrthographicCamera(0,1,0,1,0,1),this.w=new Ua,this.s=this.v=null,this.n=this.t=0,this.b=b,this.a=a,this.s=new THREE.WebGLRenderTarget(b<<1,a<<1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.s.texture.generateMipmaps=!1,
this.v=new THREE.WebGLRenderTarget(b<<1,a<<1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.v.texture.generateMipmaps=!1,this.j=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat}),this.j.texture.generateMipmaps=!1;var c=THREE.UniformsUtils.merge([THREE.UniformsLib.common]);this.g=new THREE.ShaderMaterial({uniforms:c,vertexShader:'\n        varying vec4 position_;\n\n        void main() {\n          position_ = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          gl_Position = position_;\n        }\n      ',fragmentShader:'\n        varying vec4 position_;\n\n        void main() {\n          float depth = position_.z / position_.w * 0.5 + 0.5;\n          vec3 v = fract(depth * vec3(1.0, 256.0, 65536.0));\n          v = floor(v * 256.0) / 256.0;\n          gl_FragColor = vec4(v, 1.0);\n        }\n      '}),c=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{map:{type:'t',value:null}},
{previous:{type:'t',value:null}},{rayLight:{type:'v3',value:new THREE.Vector3}}]),c.map.value=this.j,this.i=new THREE.ShaderMaterial({uniforms:c,vertexShader:'\n        attribute vec2 updateUV;\n        attribute vec3 updatePosition;\n        varying vec3 worldPosition;\n        varying vec4 clipPosition;\n        varying vec2 updateUV_;\n\n        void main() {\n          updateUV_ = updateUV;\n          worldPosition = updatePosition;\n          clipPosition = projectionMatrix * modelViewMatrix * vec4(updatePosition, 1.0);\n          gl_Position = vec4(updateUV * 2.0 - 1.0, 0.0, 1.0);\n        }\n      ',fragmentShader:'\n        uniform sampler2D map;\n        uniform sampler2D previous;\n        uniform vec3 rayLight;\n        varying vec3 worldPosition;\n        varying vec4 clipPosition;\n        varying vec2 updateUV_;\n\n        void main() {\n          vec3 position = clipPosition.xyz / clipPosition.w * 0.5 + 0.5;\n          vec3 encoded = texture2D(map, position.xy).rgb;\n          float depth = dot(encoded, vec3(1.0, 1.0 / 256.0, 1.0 / 65536.0));\n          vec3 normal = normalize(cross(dFdx(worldPosition), dFdy(worldPosition)));\n          float visibility = float(depth + 1.0 / 512.0 > position.z) * max(0.0, dot(rayLight, normal));\n\n          float accumulationFactor = 1.0 / 64.0;\n          vec4 previous8 = texture2D(previous, updateUV_);\n          vec2 previous16 = vec2(\n            dot(previous8.rg, vec2(1.0, 1.0 / 256.0)),\n            dot(previous8.ba, vec2(1.0, 1.0 / 256.0)));\n          vec2 next16 = mix(previous16, vec2(1.0 - visibility, 1.0), accumulationFactor);\n          vec4 next8 = fract(vec4(next16.x * vec2(1.0, 256.0), next16.y * vec2(1.0, 256.0)));\n          next8 = floor(next8 * 256.0) / 256.0;\n          gl_FragColor = next8;\n        }\n      ',
derivatives:!0}),c=THREE.UniformsUtils.merge([THREE.UniformsLib.common]),this.h=new THREE.ShaderMaterial({uniforms:c,vertexShader:'\n        void main() {\n          gl_Position = vec4(position, 1.0);\n        }\n      ',fragmentShader:'\n        void main() {\n          gl_FragColor = vec4(0.0);\n        }\n      '});var d=Ra(b,a);this.m=new Int32Array(d);for(var e=0;e<d;++e)this.m[e]=(e+1|0)^d?e+1|0:-1}function Ya(b){this.b=this.a=null,this.c=new THREE.Vector4,this.d=new THREE.Vector3,this.e=new THREE.Matrix4,this.g=new THREE.Scene,this.i=new THREE.OrthographicCamera(0,1,0,1,0,1),this.h=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.j=!0,this.b=b;var a=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{map:{type:'t',value:null}},{cameraToWorldMatrix:{type:'m4',value:new THREE.Matrix4}},{clearColor:{type:'c',value:b.d}},{uvLight:{type:'v3',value:new THREE.Vector3}},{rayLight:{type:'v3',value:new THREE.Vector3}},{randomSeed:{type:'f',
value:0}},{godrayStrength:{type:'f',value:0}}]);a.map.value=this.h,this.h.texture.generateMipmaps=!1,this.a=new THREE.ShaderMaterial({uniforms:a,vertexShader:[THREE.ShaderChunk.uv_pars_vertex,'\n        uniform mat4 cameraToWorldMatrix;\n        varying vec3 ray_;\n        varying vec2 uv_;\n\n        void main() {\n          vec4 projected = cameraToWorldMatrix * vec4(position.xy, 1.0, 1.0);\n          uv_ = uv;\n          ray_ = projected.xyz / projected.w;\n          gl_Position = vec4(position, 1.0);\n        }\n        '].join('\n'),fragmentShader:[THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.map_pars_fragment,'\n        uniform sampler2D map;\n        uniform float randomSeed;\n        uniform vec3 clearColor;\n        uniform vec3 rayLight;\n        uniform vec3 uvLight;\n        uniform float godrayStrength;\n        varying vec3 ray_;\n        varying vec2 uv_;\n\n        float lightMagnitude(vec3 ray) {\n          float falloff = max(0.0, dot(rayLight, normalize(ray)));\n          return pow(falloff, 4.0);\n        }\n\n        float godray() {\n          if (godrayStrength == 0.0) {\n            return 0.0;\n          }\n\n          float random = fract(sin(dot(gl_FragCoord.xy + randomSeed, vec2(12.9898, 78.233))) * 43758.5453);\n          vec3 deltaRayX = dFdx(ray_) / dFdx(uv_).x;\n          vec3 deltaRayY = dFdy(ray_) / dFdy(uv_).y;\n          const int count = 12;\n          float alpha = 0.0;\n\n          for (int i = 0; i < count; i++) {\n            float t = (float(i) + random) / float(count);\n            vec2 uv = mix(uv_, uvLight.xy, t * 0.5);\n            vec3 ray = ray_ +\n              deltaRayX * (uv.x - uv_.x) +\n              deltaRayY * (uv.y - uv_.y);\n            float magnitude = lightMagnitude(ray);\n\n            if (magnitude != 0.0) {\n              float occlusion = 1.0 - texture2D(map, uv).a;\n              float falloff = 1.0 - t;\n              alpha += occlusion * falloff;\n            }\n          }\n\n          // The integral of (1.0 - t) from 0 to 1 is 0.5\n          alpha *= 2.0;\n\n          return alpha * godrayStrength / float(count);\n        }\n\n        void main() {\n          vec4 color = texture2D(map, uv_);\n          vec3 backgroundColor = mix(clearColor, vec3(1.0), lightMagnitude(ray_));\n          color.rgb = mix(backgroundColor, color.rgb, color.a);\n          color.rgb += godray();\n          gl_FragColor = color;\n        }\n        '].join('\n'),
derivatives:!0}),this.g.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2,1,1),this.a))}function Za(b){this.b=this.a=null,this.c=null,this.d=[],this.e={},this.g=new THREE.Group,this.i=new THREE.Group,this.h=new THREE.Group,this.j=new THREE.Frustum,this.m=new THREE.Box3,this.l=new THREE.Matrix4,this.o=new THREE.Vector3,this.p=new THREE.Vector3,this.f=new Wa(1024,1024),this.r=96,this.k=60,this.b=b,this.a=new THREE.TextureLoader().load('terrain.png'),this.a.minFilter=this.a.magFilter=THREE.NearestFilter;var a=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{map:{type:'t',value:null}},{lightmap:{type:'t',value:null}},{rayLight:{type:'v3',value:new THREE.Vector3}},{clearColor:{type:'c',value:b.d}},{drawDistance:{type:'f',value:0}},{randomSeed:{type:'f',value:0}},{renderTextureMap:{type:'i',value:!0}},{renderFog:{type:'i',value:!0}},{renderOcclusion:{type:'i',value:!0}}]);a.map.value=this.a,a.lightmap.value=this.f.s,this.c=new THREE.ShaderMaterial({uniforms:a,vertexShader:'\n        attribute vec4 uvs;\n        varying vec3 worldSpacePosition;\n        varying vec3 cameraSpacePosition;\n        varying vec4 uvs_;\n\n        void main() {\n          worldSpacePosition = position;\n          vec4 transformed = modelViewMatrix * vec4(position, 1.0);\n          cameraSpacePosition = transformed.xyz / transformed.w;\n          uvs_ = uvs;\n          gl_Position = projectionMatrix * transformed;\n        }\n      ',
fragmentShader:[THREE.ShaderChunk.common,'\n        uniform bool renderTextureMap;\n        uniform bool renderFog;\n        uniform bool renderOcclusion;\n        uniform sampler2D map;\n        uniform sampler2D lightmap;\n        uniform float randomSeed;\n        uniform vec3 rayLight;\n        uniform vec3 clearColor;\n        uniform float drawDistance;\n        varying vec3 worldSpacePosition;\n        varying vec3 cameraSpacePosition;\n        varying vec4 uvs_;\n\n        void main() {\n          // Occlusion\n          float occlusion;\n          if (renderOcclusion) {\n            vec4 sample = texture2D(lightmap, uvs_.zw);\n            occlusion = 1.0 -\n              dot(sample.rg, vec2(1.0, 1.0 / 256.0)) /\n              dot(sample.ba, vec2(1.0, 1.0 / 256.0));\n            occlusion = 0.01 + 0.99 * occlusion;\n          } else {\n            vec3 normal = normalize(cross(dFdx(worldSpacePosition), dFdy(worldSpacePosition)));\n            occlusion = 0.1 + 0.9 * max(0.0, dot(rayLight, normal));\n          }\n\n          // Terrain\n          vec3 color = renderTextureMap ? inputToLinear(texture2D(map, uvs_.xy).rgb) * occlusion : vec3(occlusion);\n          if (renderFog) {\n            float fade = max(0.0, 1.0 - length(cameraSpacePosition) / drawDistance);\n            color = mix(inputToLinear(clearColor), color, 1.0 - exp(fade * fade * -5.541263545158676));\n          }\n\n          // Finalize\n          color = linearToOutput(color);\n          float random = fract(sin(dot(gl_FragCoord.xy + randomSeed, vec2(12.9898, 78.233))) * 43758.5453);\n          color += (random - 0.5) / 255.0;\n          gl_FragColor = vec4(color, 1.0);\n        }\n        '].join('\n'),
derivatives:!0}),b.b.add(this.g),this.f.c.add(this.i),this.f.d.add(this.h),this.h.frustumCulled=!1}function _a(){this.b=new THREE.Vector3,this.a=new THREE.Vector3}function $a(b){this.b=this.a=null,this.c=new THREE.DirectionalLight(16777215,1),this.d=new THREE.Color(13426158),this.b=b,this.c.position.set(1,3,2),this.c.position.normalize(),b.add(this.c),this.a=new Za(this)}var Qa=new Uint8Array([0,0,0,2,2,2,0,2,3,1,1,1,66,2,68,6,6,5]);Xa()})();
